<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è ‚Äî –ö–æ—Ñ–µ –ì–∞—Ä–¥–µ–Ω</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <style>
    :root {
      --bg: #f5f5f7;
      --card-bg: #ffffff;
      --text-main: #222222;
      --text-muted: #777777;
      --accent: #007bff;
      --border: #dddddd;
      --group-bg: #eeeeee;
      --group-active-bg: #007bff;
      --group-active-color: #ffffff;
      --group-filled-bg: #ffd54f;
      --group-filled-border: #ffb300;
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 0;
      background: var(--bg);
      color: var(--text-main);
      -webkit-text-size-adjust: 100%;
    }

    header {
      background: #222;
      color: #fff;
      padding: 12px 16px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    header h1 {
      margin: 0;
      font-size: 18px;
      font-weight: 600;
    }

    header span {
      font-size: 13px;
      opacity: 0.8;
    }

    main {
      display: flex;
      gap: 16px;
      padding: 16px;
    }

    .sidebar {
      width: 260px;
      background: var(--card-bg);
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      padding: 14px;
      flex-shrink: 0;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .sidebar h2 {
      margin: 0 0 4px;
      font-size: 15px;
    }

    .sidebar p {
      font-size: 12px;
      color: var(--text-muted);
      margin: 0;
    }

    .group-list {
      margin-top: 8px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      max-height: 360px;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }

    .group-btn {
      width: 100%;
      padding: 10px 10px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: var(--group-bg);
      font-size: 14px;
      text-align: left;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 6px;
      min-height: 40px;
      -webkit-tap-highlight-color: transparent;
    }

    .group-btn span.label {
      flex: 1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .group-btn span.badge {
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(0,0,0,0.06);
    }

    .group-btn.active {
      background: var(--group-active-bg);
      color: var(--group-active-color);
      border-color: var(--group-active-bg);
    }

    .group-btn.filled {
      background: var(--group-filled-bg);
      border-color: var(--group-filled-border);
      color: #000;
    }

    .group-btn.active.filled {
      background: linear-gradient(90deg, var(--group-filled-bg), var(--group-active-bg));
      color: #000;
      border-color: var(--group-filled-border);
    }

    .content {
      flex: 1;
      background: var(--card-bg);
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      padding: 14px;
      display: flex;
      flex-direction: column;
      min-height: 260px;
    }

    .content-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      gap: 8px;
      flex-wrap: wrap;
    }

    .content-header h2 {
      margin: 0;
      font-size: 15px;
    }

    .content-header small {
      color: var(--text-muted);
      font-size: 12px;
    }

    #tableContainer {
      flex: 1;
      min-height: 120px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }

    thead {
      background: #fafafa;
      position: sticky;
      top: 0;
      z-index: 1;
    }

    th, td {
      padding: 8px 6px;
      border-bottom: 1px solid #eee;
    }

    th {
      text-align: left;
      font-weight: 600;
      font-size: 12px;
      color: #555;
    }

    tbody tr:nth-child(even) {
      background: #fafafa;
    }

    input[type="number"] {
      width: 100%;
      max-width: 100px;
      padding: 8px 6px;
      font-size: 15px;
      border-radius: 8px;
      border: 1px solid #ccc;
    }

    .actions {
      margin-top: 10px;
      display: flex;
      gap: 8px;
      justify-content: flex-end;
      flex-wrap: wrap;
    }

    button {
      padding: 10px 16px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 14px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      min-height: 44px;
      -webkit-tap-highlight-color: transparent;
    }

    button.primary {
      background: var(--accent);
      color: #fff;
    }

    button.secondary {
      background: #e5e5ea;
      color: var(--text-main);
    }

    button:disabled {
      opacity: 0.6;
      cursor: default;
    }

    .empty-group {
      color: var(--text-muted);
      font-size: 14px;
    }

    @media (max-width: 768px) {
      main {
        flex-direction: column;
        padding: 10px;
      }

      .sidebar {
        width: 100%;
        max-width: 100%;
      }

      .content {
        width: 100%;
        margin-top: 8px;
      }

      header {
        padding: 10px 12px;
      }

      header h1 {
        font-size: 16px;
      }

      table {
        font-size: 12px;
      }

      th, td {
        padding: 6px 4px;
      }

      input[type="number"] {
        max-width: 80px;
      }
    }
  </style>
</head>
<body>
<header>
  <h1>–ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è ‚Äî –ö–æ—Ñ–µ –ì–∞—Ä–¥–µ–Ω</h1>
  <span>–ì—Ä—É–ø–ø—ã –∫–∞–∫ –∫–Ω–æ–ø–∫–∏, –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–æ –ø–æ–¥ –º–æ–±–∏–ª—å–Ω—ã–µ</span>
</header>

<main>
  <aside class="sidebar">
    <h2>–®–∞–≥ 1</h2>
    <p>–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –≥—Ä—É–ø–ø—É. –ü–æ—Å–ª–µ –≤–≤–æ–¥–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ö–æ—Ç—è –±—ã –ø–æ –æ–¥–Ω–æ–º—É —Ç–æ–≤–∞—Ä—É –∫–Ω–æ–ø–∫–∞ –≥—Ä—É–ø–ø—ã —Å—Ç–∞–Ω–µ—Ç –∂—ë–ª—Ç–æ–π.</p>
    <div class="group-list" id="groupButtons"></div>
  </aside>

  <section class="content">
    <div class="content-header">
      <h2 id="groupTitle">–ì—Ä—É–ø–ø–∞ –Ω–µ –≤—ã–±—Ä–∞–Ω–∞</h2>
      <small id="groupMeta"></small>
    </div>

    <div id="tableContainer">
      <p class="empty-group">–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É —Å–ª–µ–≤–∞, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –∏–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—é.</p>
    </div>

    <div class="actions">
      <button class="secondary" type="button" onclick="clearQuantities()">–û—á–∏—Å—Ç–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞</button>
      <button class="primary" type="button" onclick="saveResult()" id="saveBtn" disabled>
        üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
      </button>
    </div>
  </section>
</main>

<script>
  // --- –ü–æ–ª–µ–∑–Ω—ã–π –ø–æ–ª–∏—Ñ–∏–ª–ª –¥–ª—è Object.keys –Ω–∞ —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–∞—Ö ---
  if (!Object.keys) {
    Object.keys = function (obj) {
      var result = [];
      for (var prop in obj) {
        if (Object.prototype.hasOwnProperty.call(obj, prop)) {
          result.push(prop);
        }
      }
      return result;
    };
  }

  // –î–∞–Ω–Ω—ã–µ –∏–∑ Excel (–ø—Ä–∏–º–µ—Ä ‚Äî –¥–æ–ø–æ–ª–Ω–∏ –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)
  var INVENTORY_DATA = {
    "–ì—Ä—É–ø–ø–∞": [
      {"code": "4680167840074", "name": "–ú–æ–ª–æ–∫–æ –±–µ–∑–ª–∞–∫—Ç–æ–∑–Ω–æ–µ", "unit": "–ª"},
      {"code": "4680167840075", "name": "–ú–æ–ª–æ–∫–æ –ö–æ–∫–æ—Å–æ–≤–æ–µ", "unit": "–ª"},
      {"code": "4680167840076", "name": "–ú–æ–ª–æ–∫–æ –ú–∏–Ω–¥–∞–ª—å–Ω–æ–µ", "unit": "–ª"},
      {"code": "4680167840077", "name": "–ú–æ–ª–æ–∫–æ –û–≤—Å—è–Ω–æ–µ Barista", "unit": "–ª"},
      {"code": "4680167840094", "name": "–°–ª–∏–≤–∫–∏ –¥–ª—è –≤–∑–±–∏–≤–∞–Ω–∏—è", "unit": "–ª"}
    ],
    "–°–ò–†–û–ü–´": [
      {"code": "4680167840100", "name": "–°–∏—Ä–æ–ø –í–∞–Ω–∏–ª—å", "unit": "–ª"},
      {"code": "4680167840101", "name": "–°–∏—Ä–æ–ø –ö–∞—Ä–∞–º–µ–ª—å", "unit": "–ª"},
      {"code": "4680167840102", "name": "–°–∏—Ä–æ–ø –õ–µ—Å–Ω–æ–π –æ—Ä–µ—Ö", "unit": "–ª"},
      {"code": "4680167840103", "name": "–°–∏—Ä–æ–ø –ö–æ–∫–æ—Å", "unit": "–ª"}
    ],
    "–•–æ–∑–∫–∞": [
      {"code": "4680167840200", "name": "–°–∞–ª—Ñ–µ—Ç–∫–∏ –±—É–º–∞–∂–Ω—ã–µ", "unit": "—É–ø–∞–∫"},
      {"code": "4680167840201", "name": "–°—Ç–∞–∫–∞–Ω—ã –±—É–º–∞–∂–Ω—ã–µ 250 –º–ª", "unit": "—à—Ç"},
      {"code": "4680167840202", "name": "–°—Ç–∞–∫–∞–Ω—ã –±—É–º–∞–∂–Ω—ã–µ 350 –º–ª", "unit": "—à—Ç"},
      {"code": "4680167840203", "name": "–ö—Ä—ã—à–∫–∏ –¥–ª—è —Å—Ç–∞–∫–∞–Ω–æ–≤", "unit": "—à—Ç"}
    ],
    "–ß–ê–ô –¢–û–í–ê–†": [
      {"code": "4680167840300", "name": "–ß–∞–π —á—ë—Ä–Ω—ã–π –ª–∏—Å—Ç–æ–≤–æ–π", "unit": "—à—Ç"},
      {"code": "4680167840301", "name": "–ß–∞–π –∑–µ–ª—ë–Ω—ã–π –ª–∏—Å—Ç–æ–≤–æ–π", "unit": "—à—Ç"},
      {"code": "4680167840302", "name": "–ß–∞–π —Ç—Ä–∞–≤—è–Ω–æ–π –∞—Å—Å–æ—Ä—Ç–∏", "unit": "—à—Ç"}
    ],
    "–≤–æ–¥–∞ / —Å–æ–∫–∏": [
      {"code": "4680167840155", "name": "–í–æ–¥–∞ –Ω–µ–≥–∞–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è 0.5", "unit": "—à—Ç"},
      {"code": "4680167840157", "name": "–í–æ–¥–∞ –≥–∞–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è 0.5", "unit": "—à—Ç"},
      {"code": "4680167840158", "name": "–°–æ–∫ —è–±–ª–æ—á–Ω—ã–π", "unit": "—à—Ç"},
      {"code": "4680167840159", "name": "–°–æ–∫ –∞–ø–µ–ª—å—Å–∏–Ω–æ–≤—ã–π", "unit": "—à—Ç"}
    ],
    "–≤—ã–ø–µ—á–∫–∞": [
      {"code": "4680167840143", "name": "–ö—Ä—É–∞—Å—Å–∞–Ω –±—É—à–µ –Ω–∞ –º–∞—Å–ª–µ", "unit": "—à—Ç"},
      {"code": "4680167840144", "name": "–ö—Ä—É–∞—Å—Å–∞–Ω —Å –º–∏–Ω–¥–∞–ª—å–Ω—ã–º –∫—Ä–µ–º–æ–º", "unit": "—à—Ç"},
      {"code": "4680167840146", "name": "–ö—Ä—É–∞—Å—Å–∞–Ω —Å —Ñ–∏—Å—Ç–∞—à–∫–æ–≤—ã–º –∫—Ä–µ–º–æ–º", "unit": "—à—Ç"},
      {"code": "4680167840145", "name": "–ö—Ä—É–∞—Å—Å–∞–Ω —Å —à–æ–∫–æ–ª–∞–¥–æ–º", "unit": "—à—Ç"},
      {"code": "4680167840147", "name": "–ö—Ä—É–∞—Å—Å–∞–Ω —Å—ã—Ä –≤–µ—Ç—á–∏–Ω–∞", "unit": "—à—Ç"},
      {"code": "4680167840150", "name": "–°–ª–æ–π–∫–∞ —Å –ö—É—Ä–æ–π", "unit": "—à—Ç"},
      {"code": "4680167840151", "name": "–°–ª–æ–π–∫–∞ —Å —Å–æ—Å–∏—Å–∫–æ–π", "unit": "—à—Ç"},
      {"code": "4680167840154", "name": "–•–∞—á–∞–ø—É—Ä–∏", "unit": "—à—Ç"}
    ]
    // –º–æ–∂–Ω–æ –¥–æ–ø–∏—Å–∞—Ç—å –æ—Å—Ç–∞–ª—å–Ω—ã–µ –≥—Ä—É–ø–ø—ã
  };

  var currentGroup = null;
  var groupButtons = {}; // groupName -> –∫–Ω–æ–ø–∫–∞

  // –ì–ª–æ–±–∞–ª—å–Ω—ã–π –∫—ç—à –≤–≤–æ–¥–∞
  var INVENTORY_STATE = {
    quantities: {}
  };

  function initGroups() {
    var container = document.getElementById('groupButtons');
    container.innerHTML = '';

    var groups = Object.keys(INVENTORY_DATA);
    groups.sort(function (a, b) {
      if (a.localeCompare) {
        return a.localeCompare(b, 'ru');
      }
      return a > b ? 1 : (a < b ? -1 : 0);
    });

    for (var i = 0; i < groups.length; i++) {
      (function (group) {
        var btn = document.createElement('button');
        btn.type = 'button';
        btn.className = 'group-btn';
        btn.innerHTML =
          '<span class="label">' + group + '</span>' +
          '<span class="badge">' + INVENTORY_DATA[group].length + '</span>';

        btn.addEventListener('click', function () {
          selectGroup(group);
        });

        container.appendChild(btn);
        groupButtons[group] = btn;
      })(groups[i]);
    }
  }

  function selectGroup(group) {
    currentGroup = group;

    // –∞–∫—Ç–∏–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞
    for (var name in groupButtons) {
      if (!groupButtons.hasOwnProperty(name)) continue;
      var btn = groupButtons[name];
      if (name === group) {
        if (btn.classList) {
          btn.classList.add('active');
        } else {
          btn.className += ' active';
        }
      } else {
        if (btn.classList) {
          btn.classList.remove('active');
        } else {
          btn.className = btn.className.replace(/\bactive\b/, '');
        }
      }
    }

    renderGroupTable(group);
  }

  function renderGroupTable(group) {
    var container = document.getElementById('tableContainer');
    var title = document.getElementById('groupTitle');
    var meta = document.getElementById('groupMeta');
    var saveBtn = document.getElementById('saveBtn');

    if (!group) {
      title.textContent = '–ì—Ä—É–ø–ø–∞ –Ω–µ –≤—ã–±—Ä–∞–Ω–∞';
      meta.textContent = '';
      container.innerHTML = '<p class="empty-group">–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É —Å–ª–µ–≤–∞, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –∏–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—é.</p>';
      saveBtn.disabled = true;
      return;
    }

    var items = INVENTORY_DATA[group] || [];
    title.textContent = '–ì—Ä—É–ø–ø–∞: ' + group;
    meta.textContent = '–ü–æ–∑–∏—Ü–∏–π: ' + items.length;
    saveBtn.disabled = items.length === 0;

    if (items.length === 0) {
      container.innerHTML = '<p class="empty-group">–í —ç—Ç–æ–π –≥—Ä—É–ø–ø–µ –Ω–µ—Ç –ø–æ–∑–∏—Ü–∏–π.</p>';
      return;
    }

    var groupState = INVENTORY_STATE.quantities[group] || {};
    var rows = '';

    for (var i = 0; i < items.length; i++) {
      var item = items[i];
      var unit = item.unit || '';
      var code = item.code || '';
      var key = code || ('i' + i); // –∫–ª—é—á –¥–ª—è –∫—ç—à–∞
      var id = 'qty_' + key;
      var value = (groupState.hasOwnProperty(key) && groupState[key] != null) ? groupState[key] : '';

      rows +=
        '<tr>' +
          '<td>' + (i + 1) + '</td>' +
          '<td>' + code + '</td>' +
          '<td>' + (item.name || '') + '</td>' +
          '<td>' + unit + '</td>' +
          '<td>' +
            '<input ' +
              'type="number" ' +
              'id="' + id + '" ' +
              'inputmode="decimal" ' +
              'min="0" ' +
              'step="0.01" ' +
              'data-code="' + code + '" ' +
              'data-name="' + (item.name || '') + '" ' +
              'data-unit="' + unit + '" ' +
              'data-key="' + key + '" ' +
              'value="' + value + '"' +
            '/>' +
          '</td>' +
        '</tr>';
    }

    container.innerHTML =
      '<div style="max-height: 360px; overflow-y: auto; -webkit-overflow-scrolling: touch;">' +
        '<table>' +
          '<thead>' +
            '<tr>' +
              '<th>#</th>' +
              '<th>–ö–æ–¥</th>' +
              '<th>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ</th>' +
              '<th>–ï–¥.</th>' +
              '<th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>' +
            '</tr>' +
          '</thead>' +
          '<tbody>' +
            rows +
          '</tbody>' +
        '</table>' +
      '</div>';

    var inputs = container.querySelectorAll('input[type="number"]');
    for (var j = 0; j < inputs.length; j++) {
      (function (inp) {
        inp.addEventListener('input', function () {
          onQtyInput(group, inp);
        });
      })(inputs[j]);
    }

    updateGroupFilledState(group);
  }

  function onQtyInput(group, input) {
    var key = input.getAttribute('data-key');
    if (!key) return;

    if (!INVENTORY_STATE.quantities[group]) {
      INVENTORY_STATE.quantities[group] = {};
    }

    var raw = input.value.replace(/^\s+|\s+$/g, '');
    if (raw === '') {
      delete INVENTORY_STATE.quantities[group][key];
    } else {
      var normalized = raw.replace(',', '.');
      var qty = parseFloat(normalized);
      if (!isNaN(qty)) {
        INVENTORY_STATE.quantities[group][key] = qty;
      } else {
        delete INVENTORY_STATE.quantities[group][key];
      }
    }

    updateGroupFilledState(group);
  }

  function updateGroupFilledState(group) {
    var btn = groupButtons[group];
    if (!btn) return;

    var groupState = INVENTORY_STATE.quantities[group];
    var anyFilled = false;
    if (groupState) {
      for (var key in groupState) {
        if (groupState.hasOwnProperty(key)) {
          anyFilled = true;
          break;
        }
      }
    }

    if (anyFilled) {
      if (btn.classList) {
        btn.classList.add('filled');
      } else {
        if (btn.className.indexOf('filled') === -1) {
          btn.className += ' filled';
        }
      }
    } else {
      if (btn.classList) {
        btn.classList.remove('filled');
      } else {
        btn.className = btn.className.replace(/\bfilled\b/, '');
      }
    }
  }

  function clearQuantities() {
    if (!currentGroup) return;
    var container = document.getElementById('tableContainer');
    var inputs = container.querySelectorAll('input[type="number"]');
    for (var i = 0; i < inputs.length; i++) {
      inputs[i].value = '';
    }

    delete INVENTORY_STATE.quantities[currentGroup];
    updateGroupFilledState(currentGroup);
  }

  function saveResult() {
    var allGroups = Object.keys(INVENTORY_STATE.quantities);
    var groupsWithData = [];
    for (var i = 0; i < allGroups.length; i++) {
      var gr = allGroups[i];
      var g = INVENTORY_STATE.quantities[gr];
      var hasKeys = false;
      for (var k in g) {
        if (g.hasOwnProperty(k)) {
          hasKeys = true;
          break;
        }
      }
      if (hasKeys) {
        groupsWithData.push(gr);
      }
    }

    if (groupsWithData.length === 0) {
      alert('–ù–µ—Ç –≤–≤–µ–¥—ë–Ω–Ω—ã—Ö –∫–æ–ª–∏—á–µ—Å—Ç–≤ –Ω–∏ –ø–æ –æ–¥–Ω–æ–π –≥—Ä—É–ø–ø–µ.');
      return;
    }

    var timestamp = new Date();
    var iso = timestamp.toISOString ? timestamp.toISOString() : '';
    var dateStr = timestamp.toLocaleString ? timestamp.toLocaleString('ru-RU') : String(timestamp);

    var resultGroups = [];

    for (var gi = 0; gi < groupsWithData.length; gi++) {
      var group = groupsWithData[gi];
      var state = INVENTORY_STATE.quantities[group];
      var itemsDef = INVENTORY_DATA[group] || [];
      var items = [];

      for (var key in state) {
        if (!state.hasOwnProperty(key)) continue;
        var qty = state[key];
        var item = null;

        // –ø–æ–∏—Å–∫ –ø–æ –∫–æ–¥—É
        for (var idx = 0; idx < itemsDef.length; idx++) {
          if (itemsDef[idx].code === key) {
            item = itemsDef[idx];
            break;
          }
        }

        // –µ—Å–ª–∏ –∫–æ–¥ –Ω–µ —Å–æ–≤–ø–∞–ª –∏ –∫–ª—é—á –≤–∏–¥–∞ iN ‚Äî –ø—Ä–æ–±—É–µ–º –ø–æ –∏–Ω–¥–µ–∫—Å—É
        if (!item && key.indexOf('i') === 0) {
          var indexNum = parseInt(key.substring(1), 10);
          if (!isNaN(indexNum) && itemsDef[indexNum]) {
            item = itemsDef[indexNum];
          }
        }

        if (item) {
          items.push({
            code: item.code || '',
            name: item.name || '',
            unit: item.unit || '',
            qty: qty
          });
        }
      }

      if (items.length > 0) {
        resultGroups.push({
          name: group,
          items: items
        });
      }
    }

    if (resultGroups.length === 0) {
      alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–ø–æ—Å—Ç–∞–≤–∏—Ç—å –≤–≤–µ–¥—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å —Ç–æ–≤–∞—Ä–∞–º–∏.');
      return;
    }

    var resultObj = {
      timestamp: iso,
      groups: resultGroups
    };

    var html =
'<!DOCTYPE html>\n' +
'<html lang="ru">\n' +
'<head>\n' +
'  <meta charset="UTF-8" />\n' +
'  <title>–ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è ‚Äî –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –≥—Ä—É–ø–ø—ã</title>\n' +
'  <style>\n' +
'    body { font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; padding: 16px; }\n' +
'    h1 { font-size: 20px; margin-bottom: 4px; }\n' +
'    h2 { font-size: 18px; margin-top: 18px; }\n' +
'    p { font-size: 14px; }\n' +
'    table { border-collapse: collapse; width: 100%; margin-top: 8px; font-size: 13px; }\n' +
'    th, td { border: 1px solid #cccccc; padding: 6px 8px; text-align: left; }\n' +
'    th { background: #f0f0f0; }\n' +
'    pre { background: #f8f8f8; padding: 8px; border-radius: 4px; font-size: 12px; overflow-x: auto; }\n' +
'    hr { margin: 18px 0; border: none; border-top: 1px solid #e0e0e0; }\n' +
'  </style>\n' +
'</head>\n' +
'<body>\n' +
'  <h1>–ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è ‚Äî –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –≥—Ä—É–ø–ø—ã</h1>\n' +
'  <p>–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è: ' + dateStr + '</p>\n';

    for (var rg = 0; rg < resultGroups.length; rg++) {
      var groupObj = resultGroups[rg];
      html +=
'  <hr />\n' +
'  <h2>–ì—Ä—É–ø–ø–∞: ' + groupObj.name + '</h2>\n' +
'  <table>\n' +
'    <thead>\n' +
'      <tr>\n' +
'        <th>#</th>\n' +
'        <th>–ö–æ–¥</th>\n' +
'        <th>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ</th>\n' +
'        <th>–ï–¥.</th>\n' +
'        <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>\n' +
'      </tr>\n' +
'    </thead>\n' +
'    <tbody>\n';

      for (var it = 0; it < groupObj.items.length; it++) {
        var item = groupObj.items[it];
        html +=
'      <tr>\n' +
'        <td>' + (it + 1) + '</td>\n' +
'        <td>' + item.code + '</td>\n' +
'        <td>' + item.name + '</td>\n' +
'        <td>' + item.unit + '</td>\n' +
'        <td>' + item.qty + '</td>\n' +
'      </tr>\n';
      }

      html +=
'    </tbody>\n' +
'  </table>\n';
    }

    html +=
'  <h2>JSON</h2>\n' +
'  <pre>' + JSON.stringify(resultObj, null, 2) + '</pre>\n' +
'</body>\n' +
'</html>\n';

    try {
      var blob = new Blob([html], { type: 'text/html;charset=utf-8' });
      var url = (window.URL || window.webkitURL).createObjectURL(blob);
      var fileName = 'inventory_all_' + (iso ? iso.slice(0, 16).replace(/[:T]/g, '-') : 'result') + '.html';

      var a = document.createElement('a');
      a.href = url;
      a.download = fileName;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);

      (window.URL || window.webkitURL).revokeObjectURL(url);
    } catch (e) {
      alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–∞–π–ª –≤ —ç—Ç–æ–º –±—Ä–∞—É–∑–µ—Ä–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Ç–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤ –æ–±—ã—á–Ω–æ–º –±—Ä–∞—É–∑–µ—Ä–µ (Safari/Chrome).');
    }
  }

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initGroups);
  } else {
    initGroups();
  }
</script>
</body>
</html>
