<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è ‚Äî –ö–æ—Ñ–µ –ì–∞—Ä–¥–µ–Ω</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root {
      --bg: #f5f5f7;
      --card-bg: #ffffff;
      --text-main: #222222;
      --text-muted: #777777;
      --accent: #007bff;
      --border: #dddddd;
      --group-bg: #eeeeee;
      --group-active-bg: #007bff;
      --group-active-color: #ffffff;
      --group-filled-bg: #ffd54f;
      --group-filled-border: #ffb300;
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 0;
      background: var(--bg);
      color: var(--text-main);
      -webkit-text-size-adjust: 100%;
    }

    header {
      background: #222;
      color: #fff;
      padding: 12px 16px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    header h1 {
      margin: 0;
      font-size: 18px;
      font-weight: 600;
    }

    header span {
      font-size: 13px;
      opacity: 0.8;
    }

    main {
      display: flex;
      gap: 16px;
      padding: 16px;
    }

    .sidebar {
      width: 260px;
      background: var(--card-bg);
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      padding: 14px;
      flex-shrink: 0;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .sidebar h2 {
      margin: 0 0 4px;
      font-size: 15px;
    }

    .sidebar p {
      font-size: 12px;
      color: var(--text-muted);
      margin: 0;
    }

    .group-list {
      margin-top: 8px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      max-height: 360px;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }

    .group-btn {
      width: 100%;
      padding: 10px 10px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: var(--group-bg);
      font-size: 14px;
      text-align: left;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 6px;
      min-height: 40px;
      -webkit-tap-highlight-color: transparent;
    }

    .group-btn span.label {
      flex: 1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .group-btn span.badge {
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(0,0,0,0.06);
    }

    .group-btn.active {
      background: var(--group-active-bg);
      color: var(--group-active-color);
      border-color: var(--group-active-bg);
    }

    .group-btn.filled {
      background: var(--group-filled-bg);
      border-color: var(--group-filled-border);
      color: #000;
    }

    .group-btn.active.filled {
      background: linear-gradient(90deg, var(--group-filled-bg), var(--group-active-bg));
      color: #000;
      border-color: var(--group-filled-border);
    }

    .content {
      flex: 1;
      background: var(--card-bg);
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      padding: 14px;
      display: flex;
      flex-direction: column;
      min-height: 260px;
    }

    .content-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      gap: 8px;
      flex-wrap: wrap;
    }

    .content-header h2 {
      margin: 0;
      font-size: 15px;
    }

    .content-header small {
      color: var(--text-muted);
      font-size: 12px;
    }

    #tableContainer {
      flex: 1;
      min-height: 120px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }

    thead {
      background: #fafafa;
      position: sticky;
      top: 0;
      z-index: 1;
    }

    th, td {
      padding: 8px 6px;
      border-bottom: 1px solid #eee;
    }

    th {
      text-align: left;
      font-weight: 600;
      font-size: 12px;
      color: #555;
    }

    tbody tr:nth-child(even) {
      background: #fafafa;
    }

    input[type="number"] {
      width: 100%;
      max-width: 100px;
      padding: 8px 6px;
      font-size: 15px;
      border-radius: 8px;
      border: 1px solid #ccc;
    }

    .actions {
      margin-top: 10px;
      display: flex;
      gap: 8px;
      justify-content: flex-end;
      flex-wrap: wrap;
    }

    button {
      padding: 10px 16px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 14px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      min-height: 44px;
      -webkit-tap-highlight-color: transparent;
    }

    button.primary {
      background: var(--accent);
      color: #fff;
    }

    button.secondary {
      background: #e5e5ea;
      color: var(--text-main);
    }

    button:disabled {
      opacity: 0.6;
      cursor: default;
    }

    .empty-group {
      color: var(--text-muted);
      font-size: 14px;
    }

    @media (max-width: 768px) {
      main {
        flex-direction: column;
        padding: 10px;
      }

      .sidebar {
        width: 100%;
        max-width: 100%;
      }

      .content {
        width: 100%;
        margin-top: 8px;
      }

      header {
        padding: 10px 12px;
      }

      header h1 {
        font-size: 16px;
      }

      table {
        font-size: 12px;
      }

      th, td {
        padding: 6px 4px;
      }

      input[type="number"] {
        max-width: 80px;
      }
    }
  </style>
</head>
<body>
<header>
  <h1>–ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è ‚Äî –ö–æ—Ñ–µ –ì–∞—Ä–¥–µ–Ω</h1>
</header>

<main>
  <aside class="sidebar">
    <h2>–®–∞–≥ 1</h2>
    <p>–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –≥—Ä—É–ø–ø—É. –ü–æ—Å–ª–µ –≤–≤–æ–¥–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ö–æ—Ç—è –±—ã –ø–æ –æ–¥–Ω–æ–º—É —Ç–æ–≤–∞—Ä—É –∫–Ω–æ–ø–∫–∞ –≥—Ä—É–ø–ø—ã —Å—Ç–∞–Ω–µ—Ç –∂—ë–ª—Ç–æ–π</p>
    <div class="group-list" id="groupButtons"></div>
  </aside>

  <section class="content">
    <div class="content-header">
      <h2 id="groupTitle">–ì—Ä—É–ø–ø–∞ –Ω–µ –≤—ã–±—Ä–∞–Ω–∞</h2>
      <small id="groupMeta"></small>
    </div>
    <p id="step2" style="margin: 0 0 8px 0; font-size: 13px; color: #555;">
        <b>–®–∞–≥ 2:</b> –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä—ã –∏ –≤–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –µ–¥–∏–Ω–∏—Ü–µ–π –∏–∑–º–µ—Ä–µ–Ω–∏—è.
    </p>

    <div id="tableContainer">
      <p class="empty-group">–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É —Å–ª–µ–≤–∞, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –∏–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—é.</p>
    </div>

    <p id="step3" style="margin: 12px 0 6px 0; font-size: 13px; color: #555;">
        <b>–®–∞–≥ 3:</b> —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏–∏ –õ–ü–† –∏–ª–∏ –∑–∞–∫—Ä–æ–π—Ç–µ MiniApp.
    </p>

    <div class="actions">
      <button class="secondary" type="button" onclick="clearQuantities()">–û—á–∏—Å—Ç–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞</button>
      <button class="primary" type="button" onclick="saveResult()" id="saveBtn" disabled>
        üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
      </button>
    </div>
  </section>
</main>

<script>
  // --- –ü–æ–ª–µ–∑–Ω—ã–π –ø–æ–ª–∏—Ñ–∏–ª–ª –¥–ª—è Object.keys –Ω–∞ —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–∞—Ö ---
  if (!Object.keys) {
    Object.keys = function (obj) {
      var result = [];
      for (var prop in obj) {
        if (Object.prototype.hasOwnProperty.call(obj, prop)) {
          result.push(prop);
        }
      }
      return result;
    };
  }

  // –î–∞–Ω–Ω—ã–µ –∏–∑ Excel (–ø—Ä–∏–º–µ—Ä ‚Äî –¥–æ–ø–æ–ª–Ω–∏ –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)
  var INVENTORY_DATA = {
  "–≤–æ–¥–∞ / —Å–æ–∫–∏": [
    {"code": "4680167840155", "name": "Coca-cola 0.33 –∂.–±", "unit": "—à—Ç"},
    {"code": "4680167840157", "name": "–í–æ–¥–∞ ¬´–ë–∞–π–∫–∞–ª¬ª 0,45", "unit": "—à—Ç"},
    {"code": "4680167840158", "name": "–°–æ–∫ –≤ —Å—Ç–µ–∫–ª–µ 0,2 il primo", "unit": "—à—Ç"},
    {"code": "4680167840159", "name": "–°–æ–∫ –¥–µ—Ç—Å–∫–∏–π –§—Ä—É—Ç–æ –ù—è–Ω—è 0,2", "unit": "—à—Ç"}
  ],
  "–≤—ã–ø–µ—á–∫–∞": [
    {"code": "4680167840143", "name": "–ö—Ä—É–∞—Å—Å–∞–Ω –±—É—à–µ –Ω–∞ –º–∞—Å–ª–µ", "unit": "—à—Ç"},
    {"code": "4680167840144", "name": "–ö—Ä—É–∞—Å—Å–∞–Ω —Å –º–∏–Ω–¥–∞–ª—å–Ω—ã–º –∫—Ä–µ–º–æ–º", "unit": "—à—Ç"},
    {"code": "4680167840146", "name": "–ö—Ä—É–∞—Å—Å–∞–Ω —Å —Ñ–∏—Å—Ç–∞—à–∫–æ–≤—ã–º –∫—Ä–µ–º–æ–º", "unit": "—à—Ç"},
    {"code": "4680167840145", "name": "–ö—Ä—É–∞—Å—Å–∞–Ω —Å —à–æ–∫–æ–ª–∞–¥–æ–º", "unit": "—à—Ç"},
    {"code": "4680167840147", "name": "–ö—Ä—É–∞—Å—Å–∞–Ω —Å—ã—Ä –≤–µ—Ç—á–∏–Ω–∞", "unit": "—à—Ç"},
    {"code": "4680167840150", "name": "–°–ª–æ–π–∫–∞ —Å –ö—É—Ä–æ–π", "unit": "—à—Ç"},
    {"code": "4680167840151", "name": "–°–ª–æ–π–∫–∞ —Å —Å–æ—Å–∏—Å–∫–æ–π", "unit": "—à—Ç"},
    {"code": "4680167840154", "name": "–•–∞—á–∞–ø—É—Ä–∏", "unit": "—à—Ç"}
  ],
  "–¥–µ—Å–µ—Ä—Ç—ã": [
    {"code": "4680167840160", "name": "–í—É–ø–∏ –ø–∞–π –ê—Å—Å–æ—Ä—Ç–∏", "unit": "—à—Ç"},
    {"code": "4680167840250", "name": "–ö–∞–ø–∫–µ–π–∫ –í–∞–Ω–∏–ª—å–Ω—ã–π", "unit": "—à—Ç"},
    {"code": "4680167840163", "name": "–ö–∞—Ä—Ç–æ—à–∫–∞ –∫–æ—Ä–∏—á–Ω–µ–≤–∞—è", "unit": "—à—Ç"},
    {"code": "4680167840164", "name": "–ö–∞—Ä—Ç–æ—à–∫–∞ –õ–∞–≤–∞–Ω–¥–æ–≤–∞—è", "unit": "—à—Ç"},
    {"code": "4680167840165", "name": "–ö—Ä–∞—Å–Ω—ã–π –ë–∞—Ä—Ö–∞—Ç", "unit": "—à—Ç"},
    {"code": "4680167840166", "name": "–ú–µ–¥–æ–≤–∏–∫", "unit": "—à—Ç"},
    {"code": "4680167840168", "name": "–ú–£–†–ê–í–ï–ô–ù–ò–ö", "unit": "—à—Ç"},
    {"code": "4680167840169", "name": "–ù–∞–ø–æ–ª–µ–æ–Ω –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π", "unit": "—à—Ç"},
    {"code": "4680167840170", "name": "–ü–∏—Ä–æ–∂–Ω–æ–µ –ü–ê–†–ò - –ë–†–ï–°–¢", "unit": "—à—Ç"},
    {"code": "4680167840171", "name": "–ü—Ä–æ—Ñ–∏—Ç—Ä–æ–ª—å", "unit": "—à—Ç"},
    {"code": "4680167840173", "name": "–¢–∞—Ä—Ç–∞–ª–µ—Ç–∫–∞ –ë–ê–ù–û–§–§–ò", "unit": "—à—Ç"},
    {"code": "4680167840244", "name": "–¢–∞—Ä—Ç–∞–ª–µ—Ç–∫–∞ –ú–ê–ù–ì–û", "unit": "—à—Ç"},
    {"code": "4680167840251", "name": "–¢–∞—Ä—Ç–∞–ª–µ—Ç–∫–∞ –û—Ä–µ—Ö –ì—Ä–µ—Ü–∫–∏–π –ö–∞—Ä–∞–º–µ–ª—å", "unit": "—à—Ç"},
    {"code": "4680167840271", "name": "–¢–∞—Ä—Ç–∞–ª–µ—Ç–∫–∞ –Ø–±–ª–æ–∫–æ-–ö–∞—Ä–∞–º–µ–ª—å", "unit": "—à—Ç"},
    {"code": "4680167840175", "name": "–¢–æ—Ä—Ç –ø—Ç–∏—á—å–µ –º–æ–ª–æ–∫–æ", "unit": "—à—Ç"},
    {"code": "4680167840178", "name": "–≠–∫–ª–µ—Ä", "unit": "—à—Ç"}
  ],
  "–∑–µ—Ä–Ω–æ —É–ø–∞–∫–æ–≤–∫–∞": [
    {"code": "4680167840180", "name": "–ë—Ä–∞–∑–∏–ª–∏—è –ø–∏–±–µ—Ä—Ä–∏ 1 –∫–≥", "unit": "–∫–≥"},
    {"code": "4680167840182", "name": "–î—Ä–∏–ø-–ø–∞–∫–µ—Ç –≤ –∞—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç–µ", "unit": "—à—Ç"}
  ],
  "–°–ò–†–û–ü–´": [
    {"code": "4680167840232", "name": "–°–∏—Ä–æ–ø –ë–∞–±–ª –ì–∞–º", "unit": "–ª"},
    {"code": "4680167840103", "name": "–°–∏—Ä–æ–ø –ë–∞–Ω–∞–Ω–æ–≤—ã–π", "unit": "–ª"},
    {"code": "4680167840088", "name": "–°–∏—Ä–æ–ø –ë—É—Ä–±–æ–Ω-–í–∞–Ω–∏–ª–∞ –•–µ—Ä–±–∞—Ä–∏—Å—Ç–∞", "unit": "–∫–≥"},
    {"code": "4680167840226", "name": "–°–∏—Ä–æ–ø –ì—Ä—É—à–∞ —Å–æ —Å–ø–µ—Ü–∏—è–º–∏", "unit": "–ª"},
    {"code": "4680167840101", "name": "–°–∏—Ä–æ–ø –ò–º–±–∏—Ä–Ω—ã–π –ø—Ä—è–Ω–∏–∫", "unit": "–ª"},
    {"code": "4680167840228", "name": "–°–∏—Ä–æ–ø –ò—Ä–ª–∞–Ω–¥—Å–∫–∏–π –∫—Ä–µ–º", "unit": "–ª"},
    {"code": "4680167840227", "name": "–°–∏—Ä–æ–ø –ö–∞—Ä–∞–º–µ–ª—å", "unit": "–∫–≥"},
    {"code": "4680167840100", "name": "–°–∏—Ä–æ–ø –ö–µ–¥—Ä–æ–≤—ã–π", "unit": "–ª"},
    {"code": "4680167840222", "name": "–°–∏—Ä–æ–ø –ö–ª–µ–Ω –ö–∞—à—Ç–∞–Ω", "unit": "–ª"},
    {"code": "4680167840203", "name": "–°–∏—Ä–æ–ø –ö–ª—É–±–Ω–∏–∫–∞ —Å–æ —Å–ª–∏–≤–∫–∞–º–∏", "unit": "–ª"},
    {"code": "4680167840209", "name": "–°–∏—Ä–æ–ø –ö–æ–∫–æ—Å", "unit": "–ª"},
    {"code": "4680167840210", "name": "–°–∏—Ä–æ–ø –ö—Ä–∞—Å–Ω—ã–π –∞–ø–µ–ª—å—Å–∏–Ω", "unit": "–ª"},
    {"code": "4680167840208", "name": "–°–∏—Ä–æ–ø –õ–µ—Å–Ω–æ–π –æ—Ä–µ—Ö", "unit": "–ª"},
    {"code": "4680167840206", "name": "–°–∏—Ä–æ–ø –õ–µ—Å–Ω—ã–µ —è–≥–æ–¥—ã", "unit": "–ª"},
    {"code": "4680167840224", "name": "–°–∏—Ä–æ–ø –ú–∞–∫–∞–¥–∞–º–∏—è", "unit": "–ª"},
    {"code": "4680167840225", "name": "–°–∏—Ä–æ–ø –ú–∞–ª–∏–Ω–∞", "unit": "–ª"},
    {"code": "4680167840229", "name": "–°–∏—Ä–æ–ø –ú–∞–Ω–≥–æ", "unit": "–ª"},
    {"code": "4680167840099", "name": "–°–∏—Ä–æ–ø –ú–∏–∫—Å —Å–≥—É—â–µ–Ω–∫–∞", "unit": "–ª"},
    {"code": "4680167840223", "name": "–°–∏—Ä–æ–ø –ú—è—Ç–∞ –≠–≤–∫–∞–ª–∏–ø—Ç", "unit": "–ª"},
    {"code": "4680167840230", "name": "–°–∏—Ä–æ–ø –û—Å—Ç—Ä—ã–π –∫–∞–µ–Ω—Å–∫–∏–π –ø–µ—Ä–µ—Ü", "unit": "–ª"},
    {"code": "4680167840104", "name": "–°–∏—Ä–æ–ø –ü–æ–ø –∫–æ—Ä–Ω –±–ª–æ–∫–±–∞—Å—Ç–µ—Ä", "unit": "–ª"},
    {"code": "4680167840231", "name": "–°–∏—Ä–æ–ø –†–æ–º", "unit": "–ª"},
    {"code": "4680167840110", "name": "–°–∏—Ä–æ–ø –°–æ–ª–µ–Ω–∞—è –∫–∞—Ä–∞–º–µ–ª—å", "unit": "–∫–≥"},
    {"code": "4680167840240", "name": "–°–∏—Ä–æ–ø –¢–∞–±–∞–∫-–≤–∞–Ω–∏–ª—å", "unit": "–∫–≥"},
    {"code": "4680167840102", "name": "–°–∏—Ä–æ–ø –§–∏—Å—Ç–∞—à–∫–∞", "unit": "–ª"}
  ],
  "—Å—ç–Ω–¥–≤–∏—á–∏": [
    {"code": "4680167840245", "name": "–°–µ–Ω–¥–≤–∏—á –ö–†–£–ê–°–°–ê–ù —Å –ö—É—Ä–æ–π", "unit": "—à—Ç"},
    {"code": "4680167840112", "name": "–°–µ–Ω–¥–≤–∏—á –ö–†–£–ê–°–°–ê–ù —Å –§–æ—Ä–µ–ª—å—é", "unit": "—à—Ç"},
    {"code": "4680167840113", "name": "–°–µ–Ω–¥–≤–∏—á –¢–†–ï–£–ì–û–õ–¨–ù–ò–ö –∫—É—Ä–∞", "unit": "—à—Ç"},
    {"code": "4680167840114", "name": "–°–µ–Ω–¥–≤–∏—á –¢–†–ï–£–ì–û–õ–¨–ù–ò–ö —Ñ–æ—Ä–µ–ª—å", "unit": "—à—Ç"},
    {"code": "4680167840115", "name": "–°—ã—Ä–Ω–∏–∫", "unit": "—à—Ç"},
    {"code": "4680167840116", "name": "–°—ç–Ω–¥–≤–∏—á –ö–†–£–ê–°–°–ê–ù –°—ã—Ä –í–µ—Ç—á–∏–Ω–∞", "unit": "—à—Ç"},
    {"code": "4680167840117", "name": "–°—ç–Ω–¥–≤–∏—á –¢–†–ï–£–ì–û–õ–¨–ù–ò–ö —Å—ã—Ä - –≤–µ—Ç—á–∏–Ω–∞", "unit": "—à—Ç"}
  ],
  "—Ç–æ–≤–∞—Ä—ã –Ω–∞ –∫–∞—Å—Å–µ": [
    {"code": "4680167840125", "name": "–û—Ä–µ—à–∫–∏ —Å –≤–∞—Ä–µ–Ω–æ–π —Å–≥—É—â–µ–Ω–∫–æ–π ( 3 —à—Ç)", "unit": "—à—Ç"},
    {"code": "4680167840126", "name": "–ü–µ—á–µ–Ω—å–µ –∫—É–∫–∏—Å —Å–ª–∏–≤–æ—á–Ω—ã–π", "unit": "—à—Ç"},
    {"code": "4680167840127", "name": "–ü–µ—á–µ–Ω—å–µ –∫—É–∫–∏—Å —à–æ–∫–æ–ª–∞–¥–Ω—ã–π", "unit": "—à—Ç"},
    {"code": "4680167840128", "name": "–°–µ—Ä–¥—Ü–µ –≤–∞—Ñ–µ–ª—å–Ω–æ–µ –≤ –∞—Å—Å.", "unit": "—à—Ç"},
    {"code": "4680167840129", "name": "–°–µ—Ä–¥—Ü–µ –≤–∞—Ñ–µ–ª—å–Ω–æ–µ —Å–ª–∏–≤–æ—á–Ω–æ–µ", "unit": "—à—Ç"},
    {"code": "4680167840130", "name": "–°–µ—Ä–¥—Ü–µ –≤–∞—Ñ–µ–ª—å–Ω–æ–µ —à–æ–∫–æ–ª–∞–¥–Ω–æ–µ", "unit": "—à—Ç"},
    {"code": "4680167840131", "name": "–¢—Ä—É–±–æ—á–∫–∞ —Å–æ —Å–≥—É—â–µ–Ω–∫–æ–π", "unit": "—à—Ç"},
    {"code": "4680167840132", "name": "–®–æ–∫–æ–ª–∞–¥ RIOBA –≥–æ—Ä—å–∫–∏–π —à–æ–∫–æ–ª–∞–¥", "unit": "—à—Ç"},
    {"code": "4680167840133", "name": "–®–æ–∫–æ–ª–∞–¥ Ritter sport –ê—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç 16–≥—Ä", "unit": "—à—Ç"}
  ],
  "–•–æ–∑–∫–∞": [
    {"code": "4680167840069", "name": "–í–∏–ª–∫–∞ —Å—Ç–æ–ª–æ–≤–∞—è", "unit": "—à—Ç"},
    {"code": "4680167840067", "name": "–î–µ—Ä–∂–∞—Ç–µ–ª—å 4 —Å—Ç–∞–∫–∞–Ω–∞", "unit": "—à—Ç"},
    {"code": "4680167840060", "name": "–∫–æ—Ä–æ–±–∫–∞ –ë–û–õ 200 –ø–æ–¥ –∫–æ–Ω–¥–∏—Ç–µ—Ä—Å–∫–∏–µ –∏–∑–¥–µ–ª–∏—è", "unit": "—à—Ç"},
    {"code": "4680167840065", "name": "–∫–æ—Ä–æ–±–∫–∞ –ú–ê–õ 150", "unit": "—à—Ç"},
    {"code": "4680167840057", "name": "–ö—Ä—ã—à–∫–∞ 80 –º–º", "unit": "—à—Ç"},
    {"code": "4680167840058", "name": "–ö—Ä—ã—à–∫–∞ 90 –º–º", "unit": "—à—Ç"},
    {"code": "4680167840092", "name": "–ö—Ä—ã—à–∫–∞ –∫—É–ø–æ–ª–Ω–∞—è –∫ —à–µ–π–∫–µ—Ä—É", "unit": "—à—Ç"},
    {"code": "4680167840261", "name": "–ö—Ä—ã—à–∫–∞ –ø–æ–¥ —ç—Å–ø—Ä–µ—Å—Å–æ", "unit": "—à—Ç"},
    {"code": "4680167840070", "name": "–õ–æ–∂–∫–∞ —Å—Ç–æ–ª–æ–≤–∞—è", "unit": "—à—Ç"},
    {"code": "4680167840264", "name": "–ù–æ–∂ –ø–ª–∞—Å—Ç–∏–∫", "unit": "—à—Ç"},
    {"code": "4680167840062", "name": "–ü–∞–∫–µ—Ç –∫—Ä–∞—Ñ—Ç –ë–û–õ", "unit": "—à—Ç"},
    {"code": "4680167840262", "name": "–ü–æ–¥–ª–æ–∂–∫–∏ –±–æ–ª—å—à–∏–µ", "unit": "—à—Ç"},
    {"code": "4680167840095", "name": "–ø–æ–¥—Å—Ç–∞–∫–∞–Ω–Ω–∏–∫ –Ω–∞ 2 —Å—Ç", "unit": "—à—Ç"},
    {"code": "4680167840073", "name": "–°–∞–ª—Ñ–µ—Ç–∫–∏ –ë–û–õ–¨–®–ò–ï", "unit": "—à—Ç"},
    {"code": "4680167840072", "name": "–°–∞–ª—Ñ–µ—Ç–∫–∏ –Ω–∞ —Å—Ç–æ–ª", "unit": "—à—Ç"},
    {"code": "4680167840071", "name": "–°–∞–ª—Ñ–µ—Ç–∫–∏ –ø–æ–¥ –ø—Ä–∏–±–æ—Ä—ã", "unit": "—à—Ç"},
    {"code": "4680167840263", "name": "–°–∞—Ö–∞—Ä –±–µ–ª—ã–π", "unit": "—à—Ç"},
    {"code": "4680167840079", "name": "–°—Ç–∞–∫–∞–Ω –ö–ê–ü–£–ß–ò–ù–û", "unit": "—à—Ç"},
    {"code": "4680167840081", "name": "–°—Ç–∞–∫–∞–Ω –ú–ê–õ–´–ô", "unit": "—à—Ç"},
    {"code": "4680167840080", "name": "–°—Ç–∞–∫–∞–Ω –§–õ–≠–¢ —É–∞–π—Ç", "unit": "—à—Ç"},
    {"code": "4680167840079", "name": "–°—Ç–∞–∫–∞–Ω –§–õ–≠–¢ —É–∞–π—Ç  –ó–ï–õ–ï–ù–´–ô", "unit": "—à—Ç"},
    {"code": "4680167840081", "name": "–°—Ç–∞–∫–∞–Ω –§–õ–≠–¢ —É–∞–π—Ç –ó–ï–õ–ï–ù–´–ô", "unit": "—à—Ç"},
    {"code": "4680167840079", "name": "–°—Ç–∞–∫–∞–Ω –¶–ï–ù–ù–ò–ö–ò  –ö–ê–ü–£–ß–ò–ù–û", "unit": "—à—Ç"},
    {"code": "4680167840081", "name": "–°—Ç–∞–∫–∞–Ω –¶–ï–ù–ù–ò–ö–ò  –õ–ê–¢–ï", "unit": "—à—Ç"}
  ],
  "–ß–ê–ô –¢–û–í–ê–†": [
    {"code": "4680167840123", "name": "–ß–∞–π –ê—Å—Å–∞–º", "unit": "–∫–≥"},
    {"code": "4680167840120", "name": "–ß–∞–π –ì—Ä–∞—Ñ –í–æ–ª–∫–æ–Ω—Å–∫–∏–π", "unit": "–∫–≥"},
    {"code": "4680167840097", "name": "–ß–∞–π –∑–µ–ª–µ–Ω—ã–π –º–∞—Ç—á–∞ —Ü–µ—Ä–µ–º–æ–Ω–∏–∞–ª—å–Ω—ã–π", "unit": "–∫–≥"},
    {"code": "4680167840119", "name": "–ß–∞–π –†–æ–π–±—É—à –ö–∞—Ä–∞–º–µ–ª—å–Ω—ã–π", "unit": "–∫–≥"},
    {"code": "4680167840217", "name": "–ß–∞–π –°–µ–Ω—á–∞", "unit": "–∫–≥"},
    {"code": "4680167840219", "name": "–ß–∞–π –¢—Ä–∞–≤—è–Ω–æ–π", "unit": "–∫–≥"},
    {"code": "4680167840218", "name": "–ß–∞–π –§—Ä—É–∫—Ç–æ–≤—ã–π", "unit": "–∫–≥"}
  ],
  "–†–∞–∑–Ω–æ–µ": [
    {"code": "00203", "name": "–ê–ø–µ–ª—å—Å–∏–Ω —Ü–µ–ª—ã–π", "unit": "–∫–≥"},
    {"code": "4680167840242", "name": "–ë–∞–¥—å—è–Ω", "unit": "–∫–≥"},
    {"code": "4680167840137", "name": "–í–∞—Ä–µ–Ω–∞—è —Å–≥—É—â–µ–Ω–∫–∞", "unit": "–∫–≥"},
    {"code": "4680167840096", "name": "–í–æ–¥–∞ –±—É—Ç.", "unit": "–ª"},
    {"code": "00231", "name": "–ì–æ—Ä—è—á–∏–π —à–æ–∫–æ–ª–∞–¥ Ristora", "unit": "–∫–≥"},
    {"code": "4680167840140", "name": "–ò–º–±–∏—Ä—å", "unit": "–∫–≥"},
    {"code": "00207", "name": "–ö–∞–∫–∞–æ –ø–æ—Ä–æ—à–æ–∫", "unit": "–∫–≥"},
    {"code": "4680167840259", "name": "–ö–∞—Ä–¥–∞–º–æ–Ω —Å–ø–µ—Ü–∏—è", "unit": "–∫–≥"},
    {"code": "4680167840135", "name": "–ö–µ–¥—Ä–æ–≤—ã–µ –æ—Ä–µ—Ö–∏", "unit": "–∫–≥"},
    {"code": "00214", "name": "–∫–æ—Ä–∏—Ü–∞ –º–æ–ª–æ—Ç–∞—è", "unit": "–∫–≥"},
    {"code": "4680167840084", "name": "–ö–æ—Ä–∏—Ü–∞ –¶–µ–ª–∞—è", "unit": "–∫–≥"},
    {"code": "4680167840078", "name": "–ö—Ä–µ–º –£-–õ–∞-–õ–∞ –¥/–≤–∑–±–∏–≤–∞–Ω–∏—è", "unit": "–ª"},
    {"code": "00200", "name": "–õ–∏–º–æ–Ω", "unit": "–∫–≥"},
    {"code": "4680167840141", "name": "–ú–∞—Ä—à–º–µ–ª–ª–æ—É", "unit": "–∫–≥"},
    {"code": "4680167840108", "name": "–ú–µ–ª–∞–Ω–∂ —è–∏—á–Ω—ã–π", "unit": "–∫–≥"},
    {"code": "4680167840077", "name": "–ú–æ–ª–æ–∫–æ –ë–∞–Ω–∞–Ω–æ–≤–æ–µ", "unit": "–ª"},
    {"code": "4680167840074", "name": "–ú–æ–ª–æ–∫–æ –±–µ–∑–ª–∞–∫—Ç–æ–∑–Ω–æ–µ", "unit": "–ª"},
    {"code": "4680167840075", "name": "–ú–æ–ª–æ–∫–æ –ö–æ–∫–æ—Å–æ–≤–æ–µ", "unit": "–ª"},
    {"code": "4680167840076", "name": "–ú–æ–ª–æ–∫–æ –ú–∏–Ω–¥–∞–ª—å–Ω–æ–µ", "unit": "–ª"},
    {"code": "4680167840111", "name": "–ú–æ–ª–æ–∫–æ –û–≤—Å—è–Ω–Ω–æ–µ", "unit": "–ª"},
    {"code": "4680167840107", "name": "–ú–æ–ª–æ–∫–æ —Å–æ–µ–≤–æ–µ", "unit": "–ª"},
    {"code": "00199", "name": "–ú–æ–ª–æ–∫–æ –≠–ö–û–ù–ò–í–ê", "unit": "–ª"},
    {"code": "4680167840082", "name": "–ú–æ—Ä–æ–∂–µ–Ω–æ–µ –≤ –∞—Å—Å.", "unit": "–∫–≥"},
    {"code": "4680167840234", "name": "–ú–æ—Ä–æ–∂–µ–Ω–æ–µ –∫–ª—É–±–Ω–∏—á–Ω–æ–µ", "unit": "–∫–≥"},
    {"code": "4680167840233", "name": "–ú–æ—Ä–æ–∂–µ–Ω–æ–µ —à–æ–∫–æ–ª–∞–¥–Ω–æ–µ", "unit": "–∫–≥"},
    {"code": "4680167840235", "name": "–û–±–ª–µ–ø–∏—Ö–∞ —Å/–º", "unit": "–∫–≥"},
    {"code": "4680167840139", "name": "–û—Å–Ω–æ–≤–∞ –ì–ª–∏–Ω—Ç–≤–µ–π–Ω", "unit": "–ª"},
    {"code": "00212", "name": "–ü–∞—Å—Ç–∞ –∞—Ä–∞—Ö–∏—Å–æ–≤–∞—è", "unit": "–∫–≥"},
    {"code": "4680167840184", "name": "–ü–∞—Å—Ç–∞ –∫–æ–∫–æ—Å–æ–≤–∞—è", "unit": "–∫–≥"},
    {"code": "4680167840247", "name": "–ü–µ—á–µ–Ω—å–µ —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–æ–µ", "unit": "–∫–≥"},
    {"code": "4680167840258", "name": "–ü–∏—Ä–æ–∂–æ–∫ –∫–∞—Ä–µ–ª—å—Å–∫–∏–π —Å —á–µ—Ä–Ω–∏–∫–æ–π", "unit": "—à—Ç"},
    {"code": "4680167840238", "name": "–ü–æ–ø–∫–æ—Ä–Ω", "unit": "–∫–≥"},
    {"code": "00202", "name": "–°–∞—Ö–∞—Ä 1 –∫–≥", "unit": "–∫–≥"},
    {"code": "4680167840085", "name": "–°–∞—Ö–∞—Ä –í–∞–Ω–∏–ª—å–Ω—ã–π 1 –∫–≥", "unit": "–∫–≥"},
    {"code": "4680167840059", "name": "–°–∞—Ö–∞—Ä –ø–æ—Ä—Ü–∏–æ–Ω–Ω—ã–π 5 –≥—Ä", "unit": "—à—Ç"},
    {"code": "4680167840241", "name": "–°–∞—Ö–∞—Ä–æ–∑–∞–º–µ–Ω–∏—Ç–µ–ª—å –§–∏—Ç–ø–∞—Ä–∞–¥", "unit": "—à—Ç"},
    {"code": "4680167840138", "name": "–°–∏—Ä–æ–ø –ê–ø–µ–ª—å—Å–∏–Ω –ø/—Ñ", "unit": "–ª"},
    {"code": "4680167840188", "name": "–°–∏—Ä–æ–ø –õ–∏–º–æ–Ω–Ω—ã–π –ø/—Ñ", "unit": "–ª"},
    {"code": "00230", "name": "–°–ª–∏–≤–∫–∏ 10%", "unit": "–∫–≥"},
    {"code": "00204", "name": "—Å–æ–∫ RICH –∞–ø–µ–ª—å—Å–∏–Ω", "unit": "–ª"},
    {"code": "00205", "name": "—Å–æ–∫ RICH –≤–∏—à–Ω—è", "unit": "–ª"},
    {"code": "00210", "name": "–°–æ–ª—å —ç–∫—Å—Ç—Ä–∞", "unit": "–∫–≥"},
    {"code": "4680167840187", "name": "–°—Ç—Ä—É–∂–∫–∞ –∫–æ–∫–æ—Å–∞", "unit": "–∫–≥"},
    {"code": "4680167840248", "name": "–¢–æ–Ω–∏–∫", "unit": "–ª"},
    {"code": "4680167840087", "name": "–¢–æ–ø–ø–∏–Ω–≥ –º–∞–ª–∏–Ω–∞ –ú–ï–¢–†–û", "unit": "–∫–≥"},
    {"code": "4680167840239", "name": "–¢–æ–ø–ø–∏–Ω–≥ —à–æ–∫–æ–ª–∞–¥", "unit": "–∫–≥"},
    {"code": "4680167840236", "name": "–¢—ã–∫–≤–µ–Ω–Ω—ã–µ —Å–µ–º–µ—á–∫–∏", "unit": "–∫–≥"},
    {"code": "4680167840249", "name": "–§–∏—Å—Ç–∞—à–∫–∏", "unit": "–∫–≥"},
    {"code": "4680167840086", "name": "–®–æ–∫–æ–ª–∞–¥ –±–µ–ª—ã–π", "unit": "–∫–≥"},
    {"code": "4680167840237", "name": "–®–æ–∫–æ–ª–∞–¥ —Ç–µ–º–Ω—ã–π", "unit": "–∫–≥"}
  ],
  "–ë–ª—é–¥–∞, –ó–∞–≥–æ—Ç–æ–≤–∫–∏": [
    { "code": "4680167840255", "name": "–û–±–ª–µ–ø–∏—Ö–∞ –∑–∞–≥–æ—Ç–æ–≤–∫–∞ –ø/—Ñ", "unit": "–∫–≥" },
    { "code": "4680167840246", "name": "–û—Å–Ω–æ–≤–∞ –ø–æ–ø–∫–æ—Ä–Ω –ø/—Ñ", "unit": "–∫–≥" },
    { "code": "4680167840256", "name": "–ü–∞—Å—Ç–∞ –∫–µ–¥—Ä–æ–≤–∞—è –ø/—Ñ", "unit": "–∫–≥" },
    { "code": "4680167840257", "name": "–ü–∞—Å—Ç–∞ —Ñ–∏—Å—Ç–∞—à–∫–æ–≤–∞—è –ø/—Ñ", "unit": "–∫–≥" },
    { "code": "4680167840138", "name": "–°–∏—Ä–æ–ø –ê–ø–µ–ª—å—Å–∏–Ω –ø/—Ñ", "unit": "–ª" },
    { "code": "4680167840188", "name": "–°–∏—Ä–æ–ø –õ–∏–º–æ–Ω–Ω—ã–π –ø/—Ñ", "unit": "–ª" },
    { "code": "4680167840136", "name": "–®–æ—Ç —ç—Å–ø—Ä–µ—Å—Å–æ –ø/—Ñ", "unit": "–ø–æ—Ä—Ü" }
  ]
};

  var currentGroup = null;
  var groupButtons = {}; // groupName -> –∫–Ω–æ–ø–∫–∞

  // –ì–ª–æ–±–∞–ª—å–Ω—ã–π –∫—ç—à –≤–≤–æ–¥–∞
  var INVENTORY_STATE = {
    quantities: {}
  };

  function initGroups() {
    var container = document.getElementById('groupButtons');
    container.innerHTML = '';

    var groups = Object.keys(INVENTORY_DATA);
    groups.sort(function (a, b) {
      if (a.localeCompare) {
        return a.localeCompare(b, 'ru');
      }
      return a > b ? 1 : (a < b ? -1 : 0);
    });

    for (var i = 0; i < groups.length; i++) {
      (function (group) {
        var btn = document.createElement('button');
        btn.type = 'button';
        btn.className = 'group-btn';
        btn.innerHTML =
          '<span class="label">' + group + '</span>' +
          '<span class="badge">' + INVENTORY_DATA[group].length + '</span>';

        btn.addEventListener('click', function () {
          selectGroup(group);
        });

        container.appendChild(btn);
        groupButtons[group] = btn;
      })(groups[i]);
    }
  }

  function selectGroup(group) {
    currentGroup = group;

    // –∞–∫—Ç–∏–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞
    for (var name in groupButtons) {
      if (!groupButtons.hasOwnProperty(name)) continue;
      var btn = groupButtons[name];
      if (name === group) {
        if (btn.classList) {
          btn.classList.add('active');
        } else {
          btn.className += ' active';
        }
      } else {
        if (btn.classList) {
          btn.classList.remove('active');
        } else {
          btn.className = btn.className.replace(/\bactive\b/, '');
        }
      }
    }

    renderGroupTable(group);
  }

  function renderGroupTable(group) {
    var container = document.getElementById('tableContainer');
    var title = document.getElementById('groupTitle');
    var meta = document.getElementById('groupMeta');
    var saveBtn = document.getElementById('saveBtn');

    if (!group) {
      title.textContent = '–ì—Ä—É–ø–ø–∞ –Ω–µ –≤—ã–±—Ä–∞–Ω–∞';
      meta.textContent = '';
      container.innerHTML = '<p class="empty-group">–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É —Å–ª–µ–≤–∞, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –∏–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—é.</p>';
      saveBtn.disabled = true;
      return;
    }

    var items = INVENTORY_DATA[group] || [];
    title.textContent = '–ì—Ä—É–ø–ø–∞: ' + group;
    meta.textContent = '–ü–æ–∑–∏—Ü–∏–π: ' + items.length;
    saveBtn.disabled = items.length === 0;

    if (items.length === 0) {
      container.innerHTML = '<p class="empty-group">–í —ç—Ç–æ–π –≥—Ä—É–ø–ø–µ –Ω–µ—Ç –ø–æ–∑–∏—Ü–∏–π.</p>';
      return;
    }

    var groupState = INVENTORY_STATE.quantities[group] || {};
    var rows = '';

    for (var i = 0; i < items.length; i++) {
      var item = items[i];
      var unit = item.unit || '';
      var code = item.code || '';
      var key = code || ('i' + i); // –∫–ª—é—á –¥–ª—è –∫—ç—à–∞
      var id = 'qty_' + key;
      var value = (groupState.hasOwnProperty(key) && groupState[key] != null) ? groupState[key] : '';

      rows +=
        '<tr>' +
          '<td>' + (i + 1) + '</td>' +
          '<td>' + code + '</td>' +
          '<td>' + (item.name || '') + '</td>' +
          '<td>' + unit + '</td>' +
          '<td>' +
            '<input ' +
              'type="number" ' +
              'id="' + id + '" ' +
              'inputmode="decimal" ' +
              'min="0" ' +
              'step="0.01" ' +
              'data-code="' + code + '" ' +
              'data-name="' + (item.name || '') + '" ' +
              'data-unit="' + unit + '" ' +
              'data-key="' + key + '" ' +
              'value="' + value + '"' +
            '/>' +
          '</td>' +
        '</tr>';
    }

    container.innerHTML =
      '<div style="max-height: 360px; overflow-y: auto; -webkit-overflow-scrolling: touch;">' +
        '<table>' +
          '<thead>' +
            '<tr>' +
              '<th>#</th>' +
              '<th>–ö–æ–¥</th>' +
              '<th>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ</th>' +
              '<th>–ï–¥.</th>' +
              '<th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>' +
            '</tr>' +
          '</thead>' +
          '<tbody>' +
            rows +
          '</tbody>' +
        '</table>' +
      '</div>';

    var inputs = container.querySelectorAll('input[type="number"]');
    for (var j = 0; j < inputs.length; j++) {
      (function (inp) {
        inp.addEventListener('input', function () {
          onQtyInput(group, inp);
        });
      })(inputs[j]);
    }

    updateGroupFilledState(group);
  }

  function onQtyInput(group, input) {
    var key = input.getAttribute('data-key');
    if (!key) return;

    if (!INVENTORY_STATE.quantities[group]) {
      INVENTORY_STATE.quantities[group] = {};
    }

    var raw = input.value.replace(/^\s+|\s+$/g, '');
    if (raw === '') {
      delete INVENTORY_STATE.quantities[group][key];
    } else {
      var normalized = raw.replace(',', '.');
      var qty = parseFloat(normalized);
      if (!isNaN(qty)) {
        INVENTORY_STATE.quantities[group][key] = qty;
      } else {
        delete INVENTORY_STATE.quantities[group][key];
      }
    }

    updateGroupFilledState(group);
  }

  function updateGroupFilledState(group) {
    var btn = groupButtons[group];
    if (!btn) return;

    var groupState = INVENTORY_STATE.quantities[group];
    var anyFilled = false;
    if (groupState) {
      for (var key in groupState) {
        if (groupState.hasOwnProperty(key)) {
          anyFilled = true;
          break;
        }
      }
    }

    if (anyFilled) {
      if (btn.classList) {
        btn.classList.add('filled');
      } else {
        if (btn.className.indexOf('filled') === -1) {
          btn.className += ' filled';
        }
      }
    } else {
      if (btn.classList) {
        btn.classList.remove('filled');
      } else {
        btn.className = btn.className.replace(/\bfilled\b/, '');
      }
    }
  }

  function clearQuantities() {
    if (!currentGroup) return;
    var container = document.getElementById('tableContainer');
    var inputs = container.querySelectorAll('input[type="number"]');
    for (var i = 0; i < inputs.length; i++) {
      inputs[i].value = '';
    }

    delete INVENTORY_STATE.quantities[currentGroup];
    updateGroupFilledState(currentGroup);
  }

    function saveResult() {
    var allGroups = Object.keys(INVENTORY_STATE.quantities);
    var groupsWithData = [];
    for (var i = 0; i < allGroups.length; i++) {
      var gr = allGroups[i];
      var g = INVENTORY_STATE.quantities[gr];
      var hasKeys = false;
      for (var k in g) {
        if (g.hasOwnProperty(k)) {
          hasKeys = true;
          break;
        }
      }
      if (hasKeys) {
        groupsWithData.push(gr);
      }
    }

    if (groupsWithData.length === 0) {
      alert('–ù–µ—Ç –≤–≤–µ–¥—ë–Ω–Ω—ã—Ö –∫–æ–ª–∏—á–µ—Å—Ç–≤ –Ω–∏ –ø–æ –æ–¥–Ω–æ–π –≥—Ä—É–ø–ø–µ.');
      return;
    }

    var timestamp = new Date();
    var iso = timestamp.toISOString ? timestamp.toISOString() : '';
    var dateStr = timestamp.toLocaleString ? timestamp.toLocaleString('ru-RU') : String(timestamp);

    var resultGroups = [];

    for (var gi = 0; gi < groupsWithData.length; gi++) {
      var group = groupsWithData[gi];
      var state = INVENTORY_STATE.quantities[group];
      var itemsDef = INVENTORY_DATA[group] || [];
      var items = [];

      for (var key in state) {
        if (!state.hasOwnProperty(key)) continue;
        var qty = state[key];
        var item = null;

        // –ø–æ–∏—Å–∫ –ø–æ –∫–æ–¥—É
        for (var idx = 0; idx < itemsDef.length; idx++) {
          if (itemsDef[idx].code === key) {
            item = itemsDef[idx];
            break;
          }
        }

        // –µ—Å–ª–∏ –∫–æ–¥ –Ω–µ —Å–æ–≤–ø–∞–ª –∏ –∫–ª—é—á –≤–∏–¥–∞ iN ‚Äî –ø—Ä–æ–±—É–µ–º –ø–æ –∏–Ω–¥–µ–∫—Å—É
        if (!item && key.indexOf('i') === 0) {
          var indexNum = parseInt(key.substring(1), 10);
          if (!isNaN(indexNum) && itemsDef[indexNum]) {
            item = itemsDef[indexNum];
          }
        }

        if (item) {
          items.push({
            code: item.code || '',
            name: item.name || '',
            unit: item.unit || '',
            qty: qty
          });
        }
      }

      if (items.length > 0) {
        resultGroups.push({
          name: group,
          items: items
        });
      }
    }

    if (resultGroups.length === 0) {
      alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–ø–æ—Å—Ç–∞–≤–∏—Ç—å –≤–≤–µ–¥—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å —Ç–æ–≤–∞—Ä–∞–º–∏.');
      return;
    }

    var resultObj = {
      timestamp: iso,
      groups: resultGroups
    };

    // ---------- –†–∞–±–æ—Ç–∞ —á–µ—Ä–µ–∑ Telegram WebApp ----------
    var tg = (window.Telegram && window.Telegram.WebApp) ? window.Telegram.WebApp : null;

    if (tg) {
      try {
        tg.sendData(JSON.stringify(resultObj));
      } catch (e) {
        console.error('–û—à–∏–±–∫–∞ sendData:', e);
        alert('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–µ—Ä–µ–¥–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –±–æ—Ç–∞.');
        return;
      }

      try {
        tg.close();
      } catch (e) {
        console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–∫—Ä—ã—Ç—å WebApp:', e);
      }
      return;
    }

    // –ï—Å–ª–∏ –æ—Ç–∫—Ä—ã–ª–∏ –Ω–µ –∏–∑ Telegram ‚Äî –ø—Ä–æ—Å—Ç–æ –ø—Ä–µ–¥—É–ø—Ä–µ–¥–∏–º
    alert('–ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞.\n–û—Ç–∫—Ä–æ–π—Ç–µ —ç—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—É —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É –≤ Telegram-–±–æ—Ç–µ.');
    return;
  }

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initGroups);
  } else {
    initGroups();
  }
</script>
</body>
</html>
